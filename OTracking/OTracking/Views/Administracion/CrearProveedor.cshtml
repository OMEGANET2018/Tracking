@{
    string RazonSocial = "";
    int EmpresaId = 0;
    int TipoEmpresaId = 0;
    string Ruc = "";
    string Email = "";


    if (ViewBag.Empresa != null)
    {
        RazonSocial = ViewBag.Empresa.RazonSocial;
        EmpresaId = ViewBag.Empresa.EmpresaId;
        TipoEmpresaId = ViewBag.Empresa.TipoEmpresaId;
        Ruc = ViewBag.Empresa.Ruc;
        Email = ViewBag.Empresa.Email;
    }
}


<style>
    .Titulo {
        font-weight: bolder;
        font-size: 20px;
        text-align: center;
    }

    .SubTitulo {
        margin-top: 20px;
    }

    select {
        width: 186px;
        height: 28px;
    }

    .IconoMas {
        cursor: pointer;
        width: 20px;
        float: right;
    }

    .botonera {
        margin: 60px 0px;
    }

        .botonera > div {
            display: inline-block;
            margin-left: 30px;
            width: 150px;
            margin-top: 20px;
        }

            .botonera > div > input {
                width: 150px;
                height: 38px;
                cursor: pointer;
            }

    #Loading {
        background-color: rgba(0, 0, 0, 0.60);
        position: fixed;
        left: 0px;
        top: 0px;
        z-index: 9999;
    }

        #Loading > img {
            width: 200px;
        }

    #Accordion-Container {
        overflow: hidden;
        height: 0px;
    }

    .border {
        border: 1px solid black;
        border-radius: 20px;
        margin: 40px 20px 0px;
        padding: 20px;
    }

    input, select {
        width: 100%;
        max-width: 100%;
        height: 38px;
    }
</style>

<form style="width:100%;">
    <div class="container-fluid">
        <div class="col-12">
            <div class="row">
                <div class="col-12 col-md-5 border">
                    <div class="row">
                        <div class="col-12 Titulo">Datos de Proveedor</div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <div class="SubTitulo">Razon Social: </div>
                            <div><input type="text" id="RazonSocial" value="@RazonSocial" data-validation="length" data-validation-length="5-50" data-validation-error-msg="La Razón Social debe de tener entre 5 y 50 caracteres" /></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <div class="SubTitulo">RUC: </div>
                            <div><input type="text" id="RUC" value="@Ruc" data-validation="length" data-validation-length="8-50" data-validation-error-msg="El RUC debe de tener más de 8 caracteres" /></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <div class="SubTitulo">Tipo Empresa: </div>
                            <div>
                                @{
                                    if (ViewBag.TipoEmpresa != null)
                                    {
                                        <select id="TipoEmpresa" data-validation="number" data-validation-allowing="range[1;100]" data-validation-error-msg="Debe seleccionar una opción">
                                            @foreach (OTracking.Models.Comun.Dropdownlist G in ViewBag.TipoEmpresa)
                                            {
                                                <option value="@G.Id" @(TipoEmpresaId == G.Id ? "selected" : "")>@G.Value</option>
                                            }
                                        </select>
                                    }
                                }
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <div class="SubTitulo">Correo: </div>
                            <div><input type="email" id="Correo" value="@Email" data-validation="email length" data-validation-length="max150" /></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-12 text-center" style="color:red;display:none;" id="message"></div>
        </div>
        <div class="row">
            <div class="col-12 text-center botonera">
                <div>
                    <button class="btn-info boton form-control" style="cursor:pointer;">
                        <i class="fa fa-search"></i> Guardar
                    </button>
                </div>
                <div>
                    <button type="button" class="btn-info boton form-control" onclick="location.href='@Url.Action("Proveedores","Administracion")'" style="cursor:pointer;">
                        <i class="fa fa-search"></i> Cancelar
                    </button>
                </div>
            </div>
        </div>
    </div>
</form>

<div class="alert" role="alert" style="display:none;">
    <button type="button" class="close" data-dismiss="alert" aria-label="Close"></button>
    <span></span>
</div>

<div id="Loading" style="display:none;">
    <img src="~/Content/Images/loading.gif" />
</div>
@section scripts{
    <script src="~/Scripts/JqueryFormValidate.js"></script>
    <script src="~/Scripts/FormValidateSecurity.js"></script>
    <link href="~/Content/Themes/FormValidatorTheme.css" rel="stylesheet" type="text/css" />


    <script>
        $.validate({
            modules: 'security'
        });

        $('form').submit(function (event) {

            event.preventDefault();

            EnviarFormulario();
        });

    function EnviarFormulario() {

        var data = {
            RazonSocial: $("#RazonSocial").val(),
            Ruc: $("#RUC").val(),
            TipoEmpresaId: $("#TipoEmpresa").val(),
            Email: $("#Correo").val(),
            EmpresaId: @EmpresaId
        };

        var width = $(window).width();
        var height = $(window).height();

        $("#Loading").show().css("width", width + "px").css("height", height + "px");
        $("#Loading > img").css("margin-left", ((width - 200) / 2) + "px").css("margin-top", ((height - 266) / 2) + "px");

        $.ajax({
            cache: false,
            dataType: 'json',
            method: 'POST',
            data: data,
            url: '@(ViewBag.Empresa != null && ViewBag.EditPerson != null ? "/Administracion/EditProveedor" : "/Administracion/InsertNewProveedor")',
            success: function (json) {
                $("#Loading").hide();
                if (json) {
                    location.href = '@Url.Action("Proveedores", "Administracion")';
                } else{
                    alerta("No se pudo guardar el proveedor", "rojo");
                }
            },
            error: function (error) {
                alerta("Sucedió un error al conectarse al servidor", "rojo");
                $("#Loading").hide();
                console.log(error);
            }
        });
    }

    function updateAccordionHeight() {
        setTimeout(function () {
            $("#Accordion-Container").animate({
                height: $("#Accordion-Container > .row").height() + "px"
            }, 600);
        }, 200);
        }
    </script>
}
