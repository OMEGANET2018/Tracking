<style>
    #Loading {
        background-color: rgba(0, 0, 0, 0.60);
        position: fixed;
        left: 0px;
        top: 0px;
        z-index: 9999;
    }

        #Loading > img {
            width: 200px;
        }

    .pagination-active span {
        color: #f39c12 !important;
    }
</style>
<div class="container-fluid">
    <div class="box box-default mt-2" id="acordion">
        <div class="box-header with-border" id="heading1">
            <h3 class="box-title" style="cursor:pointer;" onclick="ColapsarFiltro('collapse1')"><i class="icon-calendar"></i> Cronograma</h3>
        </div>
        <div id="collapse1" class="box-body collapse show" aria-labelledby="heading1" style="overflow:hidden;">
            <div class="row">
                <div class="col-12 col-sm-4 col-lg-3 col-xl-3">
                    <div class="form-group">
                        <label for="">Nombre</label>
                        <input type="text" id="Nombre" class="form-control" maxlength="150" placeholder="Ingrese Nombre" />
                    </div>
                </div>
                <div class="col-12 col-sm-4 col-lg-3 col-xl-3">
                    <div class="form-group">
                        <label for="">Nro Documento</label>
                        <input type="text" id="NroDocumento" class="form-control" maxlength="150" placeholder="Ingrese Nro Documento" />
                    </div>
                </div>
                <div class="col-6 col-sm-4 col-lg-2 col-xl-1">
                    <div class="form-group">
                        <label for=""></label>
                        <button class="btn-info boton form-control" onclick="Filtrar(1)" style="cursor:pointer;">
                            <i class="fa fa-search"></i> Filtrar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="RenderBandeja">
        @Html.Partial("_BandejaCronogramaPartial")
    </div>
    <nav class="d-flex justify-content-end align-items-center flex-wrap">
        <div>
            <button class="btn-info boton form-control" onclick="NotificarSeguimiento()" style="cursor:pointer;margin-bottom:20px;">
                <i class="icon-mail"></i> Notificar Citas
            </button>
        </div>
    </nav>
    <div id="calendar"></div>
</div>

<!-- Modal Cambio de Fecha -->
<div id="ModalCambioFecha" class="modal fade" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Cambio de Fecha</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body" style="text-align:center;">
                <p><input type="datetime-local" style="height:40px;" onclick="$('#ModalCambioFecha #error').html('')" /></p>
                <p><span id="error" style="color:red;"></span></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-info boton form-control" style="cursor:pointer;" id="btnCambiar">Cambiar</button>
                <button type="button" class="btn-info boton form-control" data-dismiss="modal" style="cursor:pointer;">Cerrar</button>
            </div>
        </div>

    </div>
</div>

<!-- Modal Adjuntar -->
<div id="ModalAdjuntar" class="modal fade" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Adjuntar</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body" style="text-align:center;">
                <p><input type="file" id="inputAdjuntar" onchange="GetBase64(this)" style="height:40px;" /></p>
                <p><span id="error" style="color:red;"></span></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-info boton form-control" style="cursor:pointer;" id="btnAceptar">Adjuntar</button>
                <button type="button" class="btn-info boton form-control" data-dismiss="modal" style="cursor:pointer;">Cerrar</button>
            </div>
        </div>

    </div>
</div>

<!-- Modal Control -->
<div id="ModalControl" class="modal fade" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Control</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body" style="text-align:center;">
                <p><input type="text" onclick="$('#ModalControl #error').html('')" style="height:40px;" /></p>
                <p><span id="error" style="color:red;"></span></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-info boton form-control" style="cursor:pointer;" id="btnAceptar">Guardar</button>
                <button type="button" class="btn-info boton form-control" data-dismiss="modal" style="cursor:pointer;">Cerrar</button>
            </div>
        </div>

    </div>
</div>

<div class="alert" role="alert" style="display:none;">
    <button type="button" class="close" data-dismiss="alert" aria-label="Close"></button>
    <span></span>
</div>

<div id="Loading" style="display:none;">
    <img src="~/Content/Images/loading.gif" />
</div>

@section scripts{
    <script src="~/Scripts/moment.js"></script>
    <link href="~/Content/fullcalendar.css" rel="stylesheet" />
    <link href="~/Content/css/FullCalendar-custom.css" rel="stylesheet" />
    <link href="~/Content/css/jquery.contextMenu.css" rel="stylesheet" />
    <script src="~/Scripts/fullcalendar.js"></script>
    <script src="~/Scripts/locale-all.js"></script>
    <script src="~/Scripts/jquery.contextMenu.js"></script>
    <script src="~/Scripts/jquery.ui.position.js"></script>

    <script>
        var Base64File = "";
        $(document).ready(function () {
            Init();
        });

        function ColapsarFiltro(id) {
            setTimeout(function () {
                var height = 10;

                for (i = 0; i < $("#" + id + " .row").length; i++) {
                    height = height + $($("#" + id + " .row")[i]).height();
                }

                if ($("#" + id).height() == 0) {
                    $("#" + id).animate({ "height": height + "px", "padding": "10px" }, 400);
                } else {
                    $("#" + id).animate({ "height": "0px", "padding": "0px 10px" }, 400);
                }
            }, 200);
        }

        function ColapsarTabla(id) {
            var Altura = $("#TablaAExportar").height() + 60;

            if ($("." + id).height() == 0) {
                $("." + id).animate({ "height": Altura + "px" }, 400);
            } else {
                alturaTabla = $("." + id).height();
                $("." + id).animate({ "height": "0px" }, 400);
            }
        }

        function Filtrar(index) {
            data = {
                Nombre: $("#Nombre").val(),
                NroDocumento: $("#NroDocumento").val(),
                Index: index,
                Take: $("#take").val()
            };

            var width = $(window).width();
            var height = $(window).height();
            $("#Loading").show().css("width", width + "px").css("height", height + "px");
            $("#Loading > img").css("margin-left", ((width - 200) / 2) + "px").css("margin-top", ((height - 266) / 2) + "px");

            $.ajax({
                cache: false,
                dataType: 'html',
                method: 'POST',
                data: data,
                url: '/Seguimiento/Filtrar',
                success: function (html) {
                    if (html.indexOf("IniciarSesion") == -1) {
                        $("#Loading").hide();
                        $("#RenderBandeja").html(html);
                        Init();
                    } else {
                        location.href = "/";
                    }

                },
                error: function (error) {
                    alerta("Sucedió un error al conectarse al servidor", "rojo");
                    $("#Loading").hide();
                    console.log(error);
                }
            });
        }

        function checkAll(input) {
            $("#TablaAExportar tbody input").prop("checked", $(input).is(":checked"))
        }

        function SingleCheck() {
            var total = $("table tbody input").length;
            var checked = $("table tbody input:checked").length;

            if (checked == total)
                $("table thead input").prop("checked", true);

            if (checked == 0)
                $("table thead input").prop("checked", false);
        }

        function NotificarSeguimiento() {
            if ($("table tbody input:checked").length < 1) {
                alerta("Debe seleccionar al menos a un empleado", "rojo");
            } else {
                var ids = new Array();
                for (i = 0; i < $("table tbody input:checked").length; i++) {
                    ids.push($($("table tbody input:checked")[i]).parent().parent().attr("id"));
                }

                var data = { SeguimientoIdList: ids };

                var width = $(window).width();
                var height = $(window).height();
                $("#Loading").show().css("width", width + "px").css("height", height + "px");
                $("#Loading > img").css("margin-left", ((width - 200) / 2) + "px").css("margin-top", ((height - 266) / 2) + "px");

                $.ajax({
                    cache: false,
                    dataType: 'json',
                    method: 'POST',
                    data: data,
                    url: '/Seguimiento/NotificarSeguimiento',
                    success: function (json) {
                        $("#Loading").hide();
                        if (json == "") {
                            alerta("Mensaje Enviado!", "verde");
                        } else {
                            alerta(json, "rojo");
                        }

                    },
                    error: function (error) {
                        alerta("Sucedió un error al conectarse al servidor", "rojo");
                        $("#Loading").hide();
                        console.log(error);
                    }
                });
            }
        }

        function ValidarCambiarFecha(id) {
            var valido = true;
            if ($("#ModalCambioFecha input").val() == "") {
                $("#ModalCambioFecha #error").html("Tiene que ingresar una fecha y hora");
                valido = false;
            }

            if (moment($("#ModalCambioFecha input").val()) < new Date()) {
                $("#ModalCambioFecha #error").html("No puede ingresar una fecha y hora antigua");
                valido = false;
            }

            if (valido)
                CambiarFecha(id);
        }

        function ValidarAdjuntarCita(id) {
            var valido = true;
            if ($("#ModalAdjuntar input").val() == "") {
                $("#ModalAdjuntar #error").html("Tiene que ingresar un Archivo");
                valido = false;
            }

            if (Base64File == undefined || Base64File == "") {
                $("#ModalAdjuntar #error").html("El archivo ingresado no es válido.");
                valido = false;
            }

            if (valido)
                AdjuntarCita(id, Base64File, document.getElementById("inputAdjuntar").files[0].name);
        }

        function GetBase64(X) {
            $("#ModalAdjuntar #error").html("");

            var file = X.files[0];

            var reader = new FileReader();
            reader.onload = function () {
                Base64File = reader.result.split("base64,")[1];
            };

            reader.readAsDataURL(file);
        }
    </script>
}